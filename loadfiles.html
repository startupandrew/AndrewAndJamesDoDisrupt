<html>
<head>
  <title>Unplugged</title>
  <script type="text/javascript" src="http://static.firebase.com/v0/firebase.js"></script>
  <script type="text/javascript" src="http://www.firebase.com/js/libs/jquery-1.7.1.js"></script>
  <script type="text/javascript" src="http://www.firebase.com/submarine/js/libs/json2.min.js"></script>
  <script type="text/javascript" src="js/jquery.cookie.js"></script>
  <script type="text/javascript" src="synccarousel.js"></script>
  <script type="text/javascript" src="js/bootstrap.js"></script>
  <script type="text/javascript" src="js/bootstrap-carousel.js"></script>
  <script type="text/javascript" src="js/jgestures.min.js"></script>

  <link href="css/bootstrap.css" rel="stylesheet">
  <link href="css/bootstrap-responsive.css" rel="stylesheet">
  <link href="css/app.css" rel="stylesheet">

  <!-- Adds the Filepicker.io javascript library to the page -->
  <script src="https://api.filepicker.io/v0/filepicker.js"></script>
</head>
<body>

<div id="imageshere" style="border: 1px solid green"></div>
<a href="#" onclick="loadImages()">Load Images</a> <br />

<input type="text" id="screenid" /> <a href="#" onclick="pushToScreen()">Show On Screen</a>

<div id="myCarousel" class="carousel slide" style="width: 480px; height: 360px; border: 1px solid black;">
  <!-- Carousel items -->
  <div id="slideHolder" class="carousel-inner">
  </div>
</div>

<a onclick="slideSlides(1)">Left</a> <a onclick="slideSlides(-1)">Right</a>

<script type="text/javascript">

  //first, get the cookie if there is one
  var userCookie = $.cookie('usercookie');

  //if there isn't one already, set it.
  if(userCookie == null) {
    userCookie = '' + Math.floor(Math.random() * 1000000000);
    $.cookie('usercookie', userCookie);
  }

  //Root of the firebase data
  var dataRoot = new Firebase("http://gamma.firebase.com/unplugged/");

  //Now create a Firebase reference to the user data.
  var userDataRoot = dataRoot.child("users").child(userCookie);

  //
  var mySlides = userDataRoot.child("slides");

  //Setting up Filepicker.io with your api key
  filepicker.setKey('ARQRH6T9hQi2MVv87Hnnfz');

  function loadImages() {
    filepicker.getFile('image/*', {'multiple': true}, function(response){
      for(var i =0; i < response.length; i++) {
        var img = response[i];
        mySlides.push(img.url);
      }
    });
  }

  function pushToScreen() {
    var screenId = $("#screenid").val();
    var screenRoot = dataRoot.child("screens").child(screenId);
    screenRoot.set(userCookie);
  }

  mySlides.on("child_added", function(d) {
    $('#imageshere').prepend('<p>' + d.val() + '</p>');
  });

  //show the carousel
  displayCarousel(userDataRoot, $("#myCarousel"), $("#slideHolder"));

  var currentSlidePos = 0;
  var totalSlides = 0;

  mySlides.on("value", function(s) {
    totalSlides = 0;
    s.forEach(function() {
      totalSlides++;
    });
  });

  var slidePosRef = userDataRoot.child("position/slide");
 // slidePosRef.set(currentSlidePos);

  //And bind to swipe events
  $('#myCarousel').bind('swipetwo',function(ev, evInf) {
    if(evInf.description.indexOf("left") >= 0) {
      slideSlides(1);
    } else if(evInf.description.indexOf("right") >= 0) {
      slideSlides(-1);
    }
  });

  function slideSlides(dir) {
    currentSlidePos = (currentSlidePos + dir) % totalSlides;
    if(currentSlidePos < 0) {
      currentSlidePos = totalSlides + currentSlidePos;
    }
    slidePosRef.set(currentSlidePos);
  }

</script>

</body>
</html>
